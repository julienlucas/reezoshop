apiVersion: v1
kind: Pod
metadata:
  name: "{{ include "rzc-chart-reezoshop.fullname" . }}-tst-cx"
  labels:
    {{- include "rzc-chart-reezoshop.labels" . | nindent 4 }}
  annotations:
    "helm.sh/hook": test

spec:
  containers:
    - name: {{ include "rzc-chart-reezoshop.fullname" . }}-tst-cx
      image: reezocar.azurecr.io/rzc-docker-chart-testing:latest
      command: ["bats", "-t", "/tests/run.sh"]
      resources:
        limits:
          cpu: 100m
          memory: 500Mi
      volumeMounts:
      - mountPath: /tests
        name: tests
        readOnly: true
  {{- with .Values.imagePullSecrets }}
  imagePullSecrets:
    {{- range $secret := . }}
    - name: {{ $secret }}
    {{- end }}
  {{- end }}
  volumes:
  - name: tests
    configMap:
      name: {{ include "rzc-chart-reezoshop.fullname" . }}-test
  restartPolicy: Never

